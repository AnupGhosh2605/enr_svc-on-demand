{% extends 'base.html' %}


{% block content %}

<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.formset/1.2.2/jquery.formset.min.js" integrity="sha512-ltwjKsDTo3hW/wV66ZaEkf2wOAFxmg7rWM76J8kOcYKLSKy44WBYO/BFaNNH3NGDS8BSz3meB9wtSnm41oL+pA==" crossorigin="anonymous"></script>


<head>
  {{ form.media }}
</head>
{{ categories|json_script:"cats" }}
{{ sub_categories|json_script:"subCats" }}


<div class="">
  <section class="bg-svc">
    <div class="p-5">
      <div class="container p-3 text-white">
        <div class="mx-auto text-left p-3">
          <h3 class="banner-h1">Add a Job :</h3>
        </div>
      </div>
    </div>
  </section>

<div class="container p-5 over-me border rounded shadow bg-white mt-3">
  <form method="POST" enctype="multipart/form-data">
    {% csrf_token %}
    <table class="table">
      {{form.as_table}}
    </table>
    <div class="row" id="assets">
      {{ assetsform.management_form }}
      {% for asset in assetsform %}
        {% csrf_token  %}
         <div class="col-sm-12 p-2 link-formset m-auto">
           <div class="p-2">
             <div class="inner">
               <table class="table">
                 {{ asset.as_table }}
               </table>
             </div>
           </div>
        </div>
      {% endfor %}
    </div>

    <button type="submit" class="btn btn-primary border-0 bg-svc-match">Submit</button>
  </form>
</div>
<br><br><br><br><br>

<script type="text/javascript">
  $(`#assets .inner`).formset({
    addText: `<div class="btn m-2 btn-outline-primary"><i class="fa fa-plus"></i> Add More</div>`,
    prefix: '{{ assetsform.prefix }}',
    deleteText: `<div class="btn m-2 btn-outline-warning"><i class="fa fa-times"></i> Remove</div>`
  });
</script>
<script type="text/javascript">
  var cats = JSON.parse(document.getElementById('cats').textContent);
  var subCats = JSON.parse(document.getElementById('subCats').textContent);
  var catDiv = document.getElementById('id_category');
  var subCatDiv = document.getElementById('id_sub_category');
  cats.forEach((item, index) => {
      catDiv.innerHTML+=`<option value=${item[0]}>${item[1]}</option>`;
  })


  function makeSubCat(event){
    var catId = event.target.value;
    subCatDiv.innerHTML = '<option value="" selected="">---------</option>';
    subCats.forEach((item, index)=>{
      if(catId==item[1]){
        subCatDiv.innerHTML+=`<option value=${item[0]}>${item[2]}</option>`;
      }
    })
  }

  console.log(cats, subCats);
</script>

{% endblock %}
